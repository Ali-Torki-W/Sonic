<section class="profile">
    <header class="profile__top">
        <div>
            <h1>Profile</h1>
            <p class="muted">Update your public information.</p>
        </div>

        <div class="profile__actions">
            <a class="btn btn--ghost" routerLink="/feed">Back</a>
        </div>
    </header>

    @if (loading()) {
    <div class="panel">
        <p class="muted">Loading…</p>
    </div>
    } @else {

    @if (error()) {
    <div class="panel panel--error">
        <p class="error-text">{{ error() }}</p>
        @if (errorCode()) { <p class="muted">code: {{ errorCode() }}</p> }
    </div>
    }

    <form class="panel" [formGroup]="form" (ngSubmit)="save()">
        <div class="field">
            <label class="label">Display name</label>
            <input class="input" formControlName="displayName" placeholder="Your name" />
            @if (displayNameError()) {
            <p class="field-error">{{ displayNameError() }}</p>
            }
        </div>

        <div class="field">
            <label class="label">Bio (optional)</label>
            <textarea class="input input--textarea" rows="4" formControlName="bio"
                placeholder="A short bio…"></textarea>
        </div>

        <div class="field">
            <label class="label">Job role (optional)</label>
            <input class="input" formControlName="jobRole" placeholder="e.g. Backend Developer" />
        </div>

        <div class="field">
            <label class="label">Avatar URL (optional)</label>
            <input class="input" formControlName="avatarUrl" placeholder="https://…" />
            @if (avatarUrlError()) {
            <p class="field-error">{{ avatarUrlError() }}</p>
            }
        </div>

        <div class="field">
            <label class="label">Interests</label>

            <div class="tag-row">
                <input class="input" [value]="interestDraft()" (input)="interestDraft.set(($any($event.target)).value)"
                    (keydown.enter)="$event.preventDefault(); addInterestFromDraft()"
                    placeholder="Add one interest, press Enter…" />
                <button class="btn btn--solid" type="button" (click)="addInterestFromDraft()">Add</button>
            </div>

            @if (interestDraft().includes(',')) {
            <p class="hint hint--warn">One at a time. No commas.</p>
            }

            @if (interests().length > 0) {
            <div class="tag-list">
                @for (x of interests(); track x) {
                <button class="tag" type="button" (click)="removeInterest(x)" title="Remove">
                    {{ x }} <span class="tag__x">×</span>
                </button>
                }
            </div>
            } @else {
            <p class="muted">No interests yet.</p>
            }
        </div>

        <div class="footer">
            <button class="btn btn--ghost" type="button" (click)="cancel()" [disabled]="saving()">Cancel</button>
            <button class="btn btn--solid" type="submit" [disabled]="!canSubmit()">
                @if (saving()) { Saving… } @else { Save changes }
            </button>
        </div>
    </form>

    }
</section>